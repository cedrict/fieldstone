

The system is a layer of fluid between $y=0$ and $y=h$, with boundary conditions $T(x,y=0)=T_b$ 
and $T(x,y=h)=0$, characterized by $\rho_0$, $C_p$, $k$, $\eta_0$ which are assumed to be constant
(in space and time). 

The Rayleigh number of the system is 
\[
\Ranb= \frac{\rho_0 g_0 \alpha \Delta T h^3}{\eta_0 \kappa}
\]

The Stokes equation is $\vec \nabla \cdot \bm \sigma + \vec b = \vec 0$ with $\vec b=\rho \vec g$. 
The components of the this equation on the $x$- and $y-$axis are:
\begin{eqnarray}
(\vec \nabla \cdot \bm \sigma)_x &=& - \rho \vec g \cdot \vec e_x = 0\\ 
(\vec \nabla \cdot \bm \sigma)_y &=& - \rho \vec g \cdot \vec e_y = \rho g_0
\end{eqnarray}
since $\vec g$ and $\vec e_y$ are in opposite directions ($\vec g = - g_0 \vec e_y$, with $g_0>0$).

The stream function formulation of the incompressible isoviscous Stokes equation is then
\[
\eta_0 \nabla^4 \Psi
= -\frac{\partial \rho g_y}{\partial x} + \frac{\partial \rho g_x}{\partial y}   
= -\frac{\partial \rho g_y}{\partial x} 
=  g_0 \frac{\partial \rho}{\partial x} 
\]
since $g_x=0$ and $g_y=\vec{g}\cdot\vec{e}_y=-g_0$.

Assuming a linearised density field with regards to temperature $\rho(T)=\rho_0 (1-\alpha T)$
we have 
\[
\frac{\partial \rho}{\partial x} 
=
-\rho_0 \alpha \frac{\partial T}{\partial x} 
\]
and then 
\begin{equation}
\nabla^4 \Psi= -\frac{\rho_0 g_0 \alpha}{\eta_0} \frac{\partial T}{\partial x} 
%= -Ra \frac{\partial T}{\partial x} 
\end{equation}
For small perturbations of the conductive state $T_c(y)=(1-y/h)T_b$ 
we define the temperature perturbation $\tilde{T}(x,y)$ such that 
\[
T(x,y)=T_c(y)+\tilde{T}(x,y)
\]
Note that the temperature perturbation $\tilde{T}$ must satisfy the homogeneous boundary 
conditions $\tilde{T}(x,y=0)=0$ and $\tilde{T}(x,y=h)=0$.

We then have 
\[
\boxed{
\nabla^4 \Psi= -\frac{\rho_0 g_0 \alpha}{\eta_0} \frac{\partial \tilde{T}}{\partial x} 
}
\]

In the absence of heat production, the temperature equation (in the Boussinesq approx.) is 
\begin{eqnarray}
&& \rho_0 C_p \left( \frac{\partial T}{\partial t} + {\vec \upnu}\cdot {\vec \nabla} T \right) 
= k \Delta T \nn\\
&\Rightarrow&
\rho_0 C_p \left( \frac{\partial (T_c+\tilde{T})}{\partial t} + {\vec \upnu}\cdot {\vec \nabla} 
(T_c+\tilde{T}) \right) 
= k \Delta (T_c+\tilde{T})
\end{eqnarray}
First we start by acknowledging that $T_c$ does not depend on time, 
so that $\partial T/\partial t = 0$.
Then, $\Delta T_c=0$ since $T_c$ is a linear function of $y$.
Finally, we assume the nonlinear 
term ${\vec \upnu}\cdot {\vec \nabla} \tilde{T} $ to be second order (temperature perturbations and 
coupled velocity changes are assumed to be small).
In the end the energy equation can be simplified as follows:
\[
\rho_0 C_p \left( \frac{\partial \tilde{T}}{\partial t} + {\vec \upnu}\cdot {\vec \nabla} T_c \right) 
= k \Delta \tilde{T}
\qquad
\Rightarrow
\qquad
\frac{\partial \tilde{T}}{\partial t} + {\vec \upnu}\cdot {\vec \nabla} T_c 
= \kappa \Delta \tilde{T}
\]
since the heat diffusion coefficient $\kappa$ is fiven by $\kappa =k/\rho_0 C_p$.

Using the relationship between velocity and stream function
$\vec\upnu=(u,v)=(\partial_y \Psi, -\partial_x \Psi)$ and 
since $\vec\nabla T_c = - (T_b/h) \vec{e}_y$ then
\[
{\vec \upnu}\cdot {\vec \nabla} T_c =  \frac{T_b}{h}   \frac{\partial \Psi}{\partial x} 
\]
and finally:
\begin{equation}
\boxed{
\frac{\partial \tilde{T}}{\partial t} - \kappa \Delta \tilde{T} 
= -  \frac{T_b}{h}   \frac{\partial \Psi}{\partial x}
}
\end{equation}
%We also have [{\color{red} prove}]
%\[
%{\bm \nabla}^4 \Psi = -Ra \frac{\partial T_1}{\partial %x}
%\]
Note: This is the same equation as in Turcotte \& Schubert, eq 6.309.

Looking at these equations, we immediately think about a separation of variables approach to solve these
equations. Both equations showcase the Laplace operator $\Delta$, and the eigenfunctions of the biharmonic operator and the Laplace operator are the same. 
We then pose that $\Psi$ and $\tilde{T}$ can be written:
\begin{eqnarray}
\Psi(x,y,t) &=& \Psi_0 \exp(pt)\exp(\pm i k_x x) \exp(\pm i k_y y) \\ %= \Psi_0 E_\psi(x,y,t) \\
\tilde{T}(x,y,t) &=& \tilde{T}_0 \exp(pt) \exp(\pm i k_x x) \exp(\pm i k_y y) %=\tilde{T}_0 E_T(x,y,t) 
\end{eqnarray}
where $\Psi_0$ and $\tilde{T}_0$ are constants, and with the notation
\[
\exp (\pm i k x) = a_k \exp (i k_x x) + b_k \exp (-i k_x x )
\]
where $a_k,b_k$ are coefficients. 

%where $k_x=2\pi/L_x$ and $k_y=2\pi/L_y$ are the horizontal and vertical wave number respectively.
It follows that
\begin{eqnarray}
\nabla^2 \Psi &=& -(k_x^2+k_y^2) \Psi \nn\\
\nabla^2 \tilde{T} &=& -(k_x^2+k_y^2) \tilde{T} \nn
\end{eqnarray}

Let us explicitely write the temperature:
\[
\tilde{T}(x,y,t) = \tilde{T}_0 \exp(pt) 
(a_k \exp(i k_x x) + b_k \exp(-i k_x x) ) 
(c_k \exp(i k_y y) + d_k \exp(-i k_y y) ) 
\]
or, 
\[
\tilde{T}(x,y,t) = \tilde{T}_0 \exp(pt) 
\left[a_k \cos(k_x x) + i b_k \sin(k_x x) \right]
\left[c_k \cos(k_y y) + i d_k \sin(k_y y) \right]
\]
The boundary conditions on $\tilde{T}$ are $\tilde{T}(y=0)=\tilde{T}(y=h)=0$.
From the first one it follows immediately that $c_k=0$. 
From the second, we arrive at $k_y h = n \pi$, which yields $\sin ( n \pi y/h)$
where $n$ is an integer.
Finally we assume here that temperature is a real quantity, not a complex one, so 
we set $b_k=0$. In the end,
\[
\tilde{T}(x,y,t) = \tilde{T}_0 \exp(pt) \cos (k_x x) \sin \left(n\pi \frac{y}{h} \right).
\]
where $n$ is an integer number.
Note that the $a_k$ and $d_k$ have been absorbed in the $\tilde{T}_0$ term. 
\todo[inline]{isn't it the case that because of $i$ in front of $d_k$ we should
instead set $a_k$ to zero so that the $i$ in front of $b_k$ multiplies with the one
in front of $d_k$ ?}


Let us now turn to the vertical component of the velocity:
\begin{eqnarray}
%u &=& \frac{\partial \Psi}{\partial y} \\
%  &=& \frac{\partial }{\partial y} \left[ A_\Psi \exp(pt)\exp(\pm i k_x x) \exp(\pm i k_y y) \right]  \\
%  &=& A_\Psi \exp(pt)\exp(\pm i k_x x) (\pm i k_y) \exp(\pm i k_y y)   \\
v 
&=& -\frac{\partial \Psi}{\partial x}  \\
&=& -\frac{\partial }{\partial x} \left[  \Psi_0 \exp(pt) 
\left[a_k \cos(k_x x) + i b_k \sin(k_x x) \right]
\left[c_k \cos(k_y y) + i d_k \sin(k_y y) \right] 
\right] \\
&=& - \Psi_0 \exp(pt) 
\left[- a_k k_x \sin(k_x x) + i b_k k_x \cos(k_x x) \right]
\left[c_k \cos(k_y y) + i d_k \sin(k_y y) \right] 
\end{eqnarray}
The boundary condition at the bottom is $v(y=0)=0$, so that $c_k=0$.
The boundary condition at the top is $v(y=h)=0$, so that $ky h = n \pi=0$ as before.
Here to we impose that $v$ be real, so that $a_k=0$.
In the end,
\[
v =  \Psi_0 \exp(pt) \cos (k_x x) \sin(n \pi y /h)
\]
and then $\Psi$ is of the form
\[
\Psi(x,y,t) = \Psi_0 \exp(pt) \sin(k_x x) \sin(n\pi y/h)
\]
We then have (we simplify notations: $k=k_x$):
\begin{eqnarray}
\Psi(x,y,t) 
&=& \Psi_0 \exp(pt)  \sin(k x) \sin(\frac{n\pi y}{h})   
= \Psi_0 \exp(pt)  \sin(\frac{2\pi}{\lambda} x) \sin(\frac{n\pi y}{h})  \\ 
\tilde{T}(x,y,t)  
&=& \tilde{T}_0 \exp(pt)  \cos(k x) \sin(\frac{n\pi y}{h})   
= \tilde{T}_0 \exp(pt)  \cos(\frac{2\pi}{\lambda} x) \sin(\frac{n\pi y}{h})   
\end{eqnarray}
\begin{remark}
Taking $n=1$ and remembering that Turcotte \& Schubert have the domain between 
$y-h/2$ and $y=h/2$, these expressions are identical to Eqs. 6.311 and 6.312 
of the book. 
\end{remark}


Then the two framed PDEs above become:
\begin{eqnarray}
&& \nabla^4 \Psi= -\frac{\rho_0 g_0 \alpha}{\eta_0} \frac{\partial T}{\partial x} \nn \\
&\Rightarrow& \nabla^4 \Psi= -\frac{\rho_0 g_0 \alpha}{\eta_0} 
\frac{\partial (T_c(y)+\tilde{T}(x,y))}{\partial x} \nn \\
&\Rightarrow& \nabla^4 \Psi= -\frac{\rho_0 g_0 \alpha}{\eta_0} \frac{\partial \tilde{T}}{\partial x} \nn \\
&\Rightarrow& 
(k^2 + n^2 \pi^2/h^2)^2 \Psi_0 \exp(pt)  \sin(k x) \sin(n\pi y/h) = \frac{\rho_0 g_0 \alpha}{\eta_0} 
 k \tilde{T}_0 \exp(pt)  \sin(k x) \sin(n\pi y/h) \nn \\ 
&\Rightarrow&
\boxed{ (k^2 + n^2 \pi^2/h^2)^2 \Psi_0     = +\frac{\rho_0 g_0 \alpha}{\eta_0}  k \tilde{T}_0 } 
\nn\\ 
&& \frac{\partial \tilde{T}}{\partial t} - \kappa \Delta \tilde{T} 
= -  \frac{T_b}{h}   \frac{\partial \Psi}{\partial x} \nn\\
&\Rightarrow & p \tilde{T} + \kappa (k^2 + n^2\pi^2/h^2) \tilde{T}   
= -  \frac{T_b}{h} k \Psi_0 \exp(pt)  \cos(k x) \sin(n\pi y/h)\nn \\
&\Rightarrow & 
\boxed{ [ p + \kappa (k^2 + n^2\pi^2/h^2) ] \tilde{T}_0  = -  \frac{T_b}{h} k \Psi_0 } \nn
\end{eqnarray}
NOTE the minus sign difference with Arie's notes in the first box of the above equations.

These equations must then be verified for all $\Psi_0$ and $\tilde{T}_0$, 
which leads to write:
\[
\left(
\begin{array}{cc}
p + \kappa (k^2+n^2\pi^2/h^2) & \frac{T_b}{h} k \\
\frac{\rho_0 g_0 \alpha}{\eta_0}  k  & -(k^2+n^2\pi^2/h^2)^2 
\end{array}
\right)
\left(
\begin{array}{c}
\tilde{T}_0 \\ \Psi_0
\end{array}
\right)
=
\left(
\begin{array}{c}
0 \\ 0
\end{array}
\right)
\]
The determinant of the matrix should be zero to have non-trivial solutions for
the amplitude factors (i.e. $\tilde{T}_0=0$ and $\Psi_0=0$ which is not helpful).
This leads to the condition: 
\begin{eqnarray}
Det 
&=& -[p + \kappa (k^2+n^2\pi^2/h^2)](k^2+n^2\pi^2/h^2)^2 - \frac{\rho_0 g_0 \alpha T_b }{\eta_0 h}  k^2 \nn\\
&=& -p (k^2+n^2\pi^2/h^2)^2 - \kappa (k^2+n^2\pi^2/h^2)^3 - \frac{\rho_0 g_0 \alpha T_b }{\eta_0 h}  k^2 \nn\\
&=& 0
\end{eqnarray}
{\color{red}At this stage it is obvious There is a minus sign problem somewhere !!!}
or, 
\begin{eqnarray}
p 
&=&\frac{\frac{\rho_0 g_0 \alpha T_b }{\eta_0 h }  \; k^2 
- \kappa (k^2+n^2\pi^2/h^2)^3 }{ (k^2+n^2\pi^2/h^2)^2} \nn\\
&=& \kappa \frac{  \frac{\rho_0 g_0 \alpha T_b h^3}{ \kappa \eta_0}\; k^2 - h^4 (k^2+n^2\pi^2/h^2)^3 }{h^4 (k^2+n^2\pi^2/h^2)^2} \nn\\
&=& \frac{\kappa}{h^4}   \frac{\Ranb \; k^2 -(k^2+n^2\pi^2/h^2)^3 }{ (k^2+n^2\pi^2/h^2)^2}
\end{eqnarray}

The coefficient $p$ determines the stability of the system: if it is negative, 
the system is stable and both $\Psi$ and $\tilde{T}$ will decay to zero (return to conductive state). 
If $p=0$, then the system is meta-stable, and if $p>0$ then the system is unstable and 
the perturbations will grow. 

The threshold is then $p=0$ and the corresponding critical Rayleigh number $\Ranb_c$ is:
\[
\Ranb_c=\frac{(k^2+n^2\pi^2/h^2)^3}{k^2}
\]

The minimum critical Rayleigh number is given by 
\[
\left. \frac{\partial \Ranb_c}{\partial k}\right|_{n=1}=0
\]
or, 
\[
\Ranb_c = \frac{27}{4}\pi^4 \simeq 657.4839
\]
This solves the linearised onset of convection problem in the sense that an
unstable layering (cold above hot) only starts convecting after a critical
Rayleigh number has been overcome, e.g., by an increased $\Delta T$



For convection to occur,
the Rayleigh number must be larger than a critical value,
which varies from 600 to 3000 depending 
on boundary conditions (stagnant lid, plate tectonics etc).	

